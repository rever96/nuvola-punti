(this["webpackJsonppoint-cloud-annotator"]=this["webpackJsonppoint-cloud-annotator"]||[]).push([[0],{132:function(n,e,t){"use strict";t.r(e);var o=t(0),i=t.n(o),a=t(12),s=t.n(a),c=(t(81),t(82),t(21)),r=t(35),u=t(33),d=t(32),l=t(1),m=t(64),f=t(65),p=function(){function n(){var e=this;Object(c.a)(this,n),this.loadPoints=function(n){return delete e.infoPoints,e.infoPoints={},new Promise((function(t,o){fetch("/nuvola-punti/assets/infopoints//"+n+".json").catch((function(n){return o(n)})).then((function(n){return n.json()})).then((function(n){e.infoPoints=n,t(e.infoPoints)}))}))},this.savePoints=function(n){if(e.infoPoints){if(window.navigator&&window.navigator.msSaveOrOpenBlob){var t=new Blob([decodeURIComponent(encodeURI(JSON.stringify(e.infoPoints)))],{type:"application/json;charset=utf-8;"});navigator.msSaveOrOpenBlob(t,n)}else{var o=document.createElement("a");o.download=n,o.href="data:application/json;charset=utf-8;,"+encodeURIComponent(JSON.stringify(e.infoPoints)),o.target="_blank",document.body.appendChild(o),o.click(),document.body.removeChild(o)}}},this.addInfoPoint=function(n,t){var o={descrizione:n.descrizione,colore:n.colore||"#ffffff",point:t};return e.infoPoints[n.titolo]=o,o}}return Object(r.a)(n,null,[{key:"getInstance",value:function(){return null==n.myInstance&&(n.myInstance=new n),this.myInstance}}]),n}();p.myInstance=null;var v,w,h,P,y,b=p,g=t(134),j=b.getInstance(),z=new l.q;z.params.Points.threshold=.01;var E=new l.v,I=[],O=0,S={position:"absolute",display:"none",left:"0px",top:"0px"},k=function(n){Object(u.a)(t,n);var e=Object(d.a)(t);function t(n){var o;return Object(c.a)(this,t),(o=e.call(this,n)).init=function(){var n=window.innerWidth,e=window.innerHeight;(h=new l.r).background=new l.b(6316128),(P=new l.x({antialias:!0})).setPixelRatio(window.devicePixelRatio),P.setSize(n,e),P.dofAutofocus=!0,o.mount.appendChild(P.domElement),(v=new l.m(65,n/e,1,1e3)).up.set(0,1,0),(w=new f.a(v,P.domElement)).enableDamping=!1,w.dampingFactor=.05,w.screenSpacePanning=!1,w.minDistance=1,w.maxDistance=500,w.maxPolarAngle=.5*Math.PI,o.addPointcloud(),o.addSphereInfo()},o.onDocumentMouseClick=function(n){n.preventDefault(),E.x=n.clientX/P.domElement.clientWidth*2-1,E.y=-n.clientY/P.domElement.clientHeight*2+1,z.setFromCamera(E,v);var e=z.intersectObjects(h.children).find((function(n){return n&&n.object&&n.object.info}));if(e){var t=v.position,i=e.point;o.setState({movePoint:e.point,moveVector:new l.w(i.x-t.x,i.y-t.y,i.z-t.z)})}},o.onDocumentMouseDown=function(n){o.setState({movePoint:null})},o.onDocumentMouseOver=function(n){if(n.preventDefault(),P){E.x=n.clientX/P.domElement.clientWidth*2-1,E.y=-n.clientY/P.domElement.clientHeight*2+1,z.setFromCamera(E,v);var e=z.intersectObjects(h.children).find((function(n){return n&&n.object&&n.object.info}));e?(e=e.object,o.state.activeInfoPoint||(S={position:"absolute",left:n.clientX,top:n.clientY},o.setState({activeInfoPoint:e.info}))):o.setState({activeInfoPoint:null})}},o.addPointcloud=function(){y=new l.n(new l.f,new l.j),(new m.a).load("/nuvola-punti/assets/pointclouds/"+o.state.impostazioniJson.visualizza+".pcd",(function(n){y=n,n.material.size=.02,h.add(y);var e=y.geometry.boundingSphere.radius;v.position.set(1.5*e,.5*e,1.5*e)}),(function(n){o.setState({loaded:Math.round(n.loaded/n.total*100)})}))},o.removePointcloud=function(){h.remove(y)},o.removeSphereKps=function(){I.forEach((function(n){var e=h.getObjectByProperty("uuid",n.uuid);e.geometry.dispose(),e.material.dispose(),h.remove(e)})),P.renderLists.dispose(),I=[]},o.addSphereInfo=function(){j.loadPoints(o.state.impostazioniJson.visualizza).catch((function(n){console.log(n)})).then((function(n){Object.keys(n).forEach((function(e){var t=v.position.distanceTo(n[e].point),o=new l.s(t/32,32,32),i=new l.l({color:n[e].colore}),a=new l.k(o,i);a.position.copy(n[e].point),I.push({uuid:a.uuid,titolo:e}),a.info={titolo:e,descrizione:n[e].descrizione},h.add(a)}))}))},o.animate=function(){o.reDrawInfoPoint(),requestAnimationFrame(o.animate),w.update(),v.updateMatrixWorld();var n=performance.now();if(o.state.moveVector){var e=(n-O)/1e3;v.position.x+=o.state.moveVector.x*e,v.position.y+=o.state.moveVector.y*e,v.position.z+=o.state.moveVector.z*e,v.position.distanceTo(o.state.movePoint)<4&&o.setState({moveVector:null})}O=n,o.state.movePoint&&v.lookAt(o.state.movePoint),P.render(h,v)},o.reDrawInfoPoint=function(){I.forEach((function(n){var e=h.getObjectByProperty("uuid",n.uuid),t=v.position.distanceTo(e.position),o=new l.s(t/32,32,32);e.geometry=o}))},o.onWindowResize=function(){v.aspect=window.innerWidth/window.innerHeight,v.updateProjectionMatrix(),P.setSize(window.innerWidth,window.innerHeight)},o.state={loaded:0,activeInfoPoint:null,movePoint:null,moveVector:null,impostazioniJson:null},fetch("assets/impostazioni.json",{headers:{"Content-Type":"application/json",Accept:"application/json"}}).then((function(n){return n.json()})).then((function(n){o.setState({impostazioniJson:n}),o.init(),o.animate()})),o}return Object(r.a)(t,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.onWindowResize,!1),window.addEventListener("click",this.onDocumentMouseClick,!1),window.addEventListener("mousemove",this.onDocumentMouseOver,!1),window.addEventListener("mousedown",this.onDocumentMouseDown,!1)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize"),window.removeEventListener("mousemove"),window.removeEventListener("mousedown"),window.removeEventListener("click")}},{key:"render",value:function(){var n=this;return i.a.createElement(i.a.Fragment,null,this.state.activeInfoPoint&&i.a.createElement(g.a,{size:"small",title:this.state.activeInfoPoint.titolo,style:S},i.a.createElement("p",null,this.state.activeInfoPoint.descrizione)),i.a.createElement("div",{style:{width:window.innerWidth,height:window.innerHeight},ref:function(e){n.mount=e}}))}}]),t}(o.Component);s.a.render(i.a.createElement(k,null),document.getElementById("root"))},76:function(n,e,t){n.exports=t(132)},82:function(n,e,t){}},[[76,1,2]]]);
//# sourceMappingURL=main.00810570.chunk.js.map