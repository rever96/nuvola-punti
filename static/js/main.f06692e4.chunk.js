(this["webpackJsonppoint-cloud-annotator"]=this["webpackJsonppoint-cloud-annotator"]||[]).push([[0],{133:function(e,n,t){"use strict";t.r(n);var o=t(0),i=t.n(o),a=t(12),r=t.n(a),c=(t(82),t(83),t(21)),s=t(34),d=t(32),l=t(31),u=t(1),f=t(64),m=t(65),p=t(28),v=function(){function e(){var n=this;Object(c.a)(this,e),this.loadPoints=function(e){return delete n.infoPoints,n.infoPoints={},new Promise((function(t,o){fetch(p.infopoints_folder+"/"+e+".json").catch((function(e){return o(e)})).then((function(e){return e.json()})).then((function(e){n.infoPoints=e,t(n.infoPoints)}))}))},this.savePoints=function(e){if(n.infoPoints){if(window.navigator&&window.navigator.msSaveOrOpenBlob){var t=new Blob([decodeURIComponent(encodeURI(JSON.stringify(n.infoPoints)))],{type:"application/json;charset=utf-8;"});navigator.msSaveOrOpenBlob(t,e)}else{var o=document.createElement("a");o.download=e,o.href="data:application/json;charset=utf-8;,"+encodeURIComponent(JSON.stringify(n.infoPoints)),o.target="_blank",document.body.appendChild(o),o.click(),document.body.removeChild(o)}}},this.addInfoPoint=function(e,t){var o={descrizione:e.descrizione,colore:e.colore||"#ffffff",point:t};return n.infoPoints[e.titolo]=o,o}}return Object(s.a)(e,null,[{key:"getInstance",value:function(){return null==e.myInstance&&(e.myInstance=new e),this.myInstance}}]),e}();v.myInstance=null;var w,h,P,b,y,g=v,j=t(135),E=g.getInstance(),I=new u.q;I.params.Points.threshold=.01;var O=new u.v,S=[],z=p.filenames[1],x=p.pcd_folder+"/",D=0,k={position:"absolute",display:"none",left:"0px",top:"0px"},M=function(e){Object(d.a)(t,e);var n=Object(l.a)(t);function t(e){var o;return Object(c.a)(this,t),(o=n.call(this,e)).init=function(){var e=window.innerWidth,n=window.innerHeight;(P=new u.r).background=new u.b(6316128),(b=new u.x({antialias:!0})).setPixelRatio(window.devicePixelRatio),b.setSize(e,n),b.dofAutofocus=!0,o.mount.appendChild(b.domElement),(w=new u.m(65,e/n,1,1e3)).up.set(0,1,0),(h=new m.a(w,b.domElement)).enableDamping=!1,h.dampingFactor=.05,h.screenSpacePanning=!1,h.minDistance=1,h.maxDistance=500,h.maxPolarAngle=.5*Math.PI,o.addPointcloud(),o.addSphereInfo()},o.onDocumentMouseClick=function(e){e.preventDefault(),O.x=e.clientX/b.domElement.clientWidth*2-1,O.y=-e.clientY/b.domElement.clientHeight*2+1,I.setFromCamera(O,w);var n=I.intersectObjects(P.children).find((function(e){return e&&e.object&&e.object.info}));if(n){var t=w.position,i=n.point;o.setState({movePoint:n.point,moveVector:new u.w(i.x-t.x,i.y-t.y,i.z-t.z)})}},o.onDocumentMouseDown=function(e){o.setState({movePoint:null})},o.onDocumentMouseOver=function(e){e.preventDefault(),O.x=e.clientX/b.domElement.clientWidth*2-1,O.y=-e.clientY/b.domElement.clientHeight*2+1,I.setFromCamera(O,w);var n=I.intersectObjects(P.children).find((function(e){return e&&e.object&&e.object.info}));n?(n=n.object,o.state.activeInfoPoint||(k={position:"absolute",left:e.clientX,top:e.clientY},o.setState({activeInfoPoint:n.info}))):o.setState({activeInfoPoint:null})},o.addPointcloud=function(){y=new u.n(new u.f,new u.j),(new f.a).load(x+"/"+z+".pcd",(function(e){y=e,e.material.size=.02,P.add(y);var n=y.geometry.boundingSphere.radius;w.position.set(1.5*n,.5*n,1.5*n)}),(function(e){o.setState({loaded:Math.round(e.loaded/e.total*100)})}))},o.removePointcloud=function(){P.remove(y)},o.removeSphereKps=function(){S.forEach((function(e){var n=P.getObjectByProperty("uuid",e.uuid);n.geometry.dispose(),n.material.dispose(),P.remove(n)})),b.renderLists.dispose(),S=[]},o.addSphereInfo=function(){E.loadPoints(z).catch((function(e){console.log(e)})).then((function(e){Object.keys(e).forEach((function(n){var t=w.position.distanceTo(e[n].point),o=new u.s(t/32,32,32),i=new u.l({color:e[n].colore}),a=new u.k(o,i);a.position.copy(e[n].point),S.push({uuid:a.uuid,titolo:n}),a.info={titolo:n,descrizione:e[n].descrizione},P.add(a)}))}))},o.animate=function(){o.reDrawInfoPoint(),requestAnimationFrame(o.animate),h.update(),w.updateMatrixWorld();var e=performance.now();if(o.state.moveVector){var n=(e-D)/1e3;w.position.x+=o.state.moveVector.x*n,w.position.y+=o.state.moveVector.y*n,w.position.z+=o.state.moveVector.z*n,w.position.distanceTo(o.state.movePoint)<4&&o.setState({moveVector:null})}D=e,o.state.movePoint&&w.lookAt(o.state.movePoint),b.render(P,w)},o.reDrawInfoPoint=function(){S.forEach((function(e){var n=P.getObjectByProperty("uuid",e.uuid),t=w.position.distanceTo(n.position),o=new u.s(t/32,32,32);n.geometry=o}))},o.onWindowResize=function(){w.aspect=window.innerWidth/window.innerHeight,w.updateProjectionMatrix(),b.setSize(window.innerWidth,window.innerHeight)},o.scaleDown=function(){var e=P.getObjectByName(z+".pcd");e.material.size*=.8,e.material.needsUpdate=!0},o.scaleUp=function(){var e=P.getObjectByName(z+".pcd");e.material.size*=1.2,e.material.needsUpdate=!0},o.onFrameUpdate=function(e){e!==z&&(z=e,o.removeSphereKps(),o.removePointcloud(),o.addPointcloud(),o.addSphereInfo())},o.state={loaded:0,activeInfoPoint:null,movePoint:null,moveVector:null},o}return Object(s.a)(t,[{key:"componentDidMount",value:function(){this.init(),window.addEventListener("resize",this.onWindowResize,!1),window.addEventListener("click",this.onDocumentMouseClick,!1),window.addEventListener("mousemove",this.onDocumentMouseOver,!1),window.addEventListener("mousedown",this.onDocumentMouseDown,!1),this.animate()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize"),window.removeEventListener("mousemove"),window.removeEventListener("mousedown"),window.removeEventListener("click")}},{key:"render",value:function(){var e=this;return i.a.createElement(i.a.Fragment,null,this.state.activeInfoPoint&&i.a.createElement(j.a,{size:"small",title:this.state.activeInfoPoint.titolo,style:k},i.a.createElement("p",null,this.state.activeInfoPoint.descrizione)),i.a.createElement("div",{style:{width:window.innerWidth,height:window.innerHeight},ref:function(n){e.mount=n}}))}}]),t}(o.Component);r.a.render(i.a.createElement(M,null),document.getElementById("root"))},28:function(e){e.exports=JSON.parse('{"build":false,"filenames":["base","casa",2,3,4,5],"pcd_folder":"./data/pointclouds","infopoints_folder":"./data/infopoints"}')},77:function(e,n,t){e.exports=t(133)},83:function(e,n,t){}},[[77,1,2]]]);
//# sourceMappingURL=main.f06692e4.chunk.js.map