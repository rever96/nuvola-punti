(this["webpackJsonppoint-cloud-annotator"]=this["webpackJsonppoint-cloud-annotator"]||[]).push([[0],{249:function(e,t,n){e.exports=n(506)},255:function(e,t,n){},506:function(e,t,n){"use strict";n.r(t);var o=n(0),a=n.n(o),i=n(7),r=n.n(i),l=(n(254),n(255),n(246)),c=n(41),s=n(55),d=n(49),u=n(48),p=n(3),h=n(225),m=n(226),f=n(227),w=n.n(f),v=n(88),g=function(){function e(){var t=this;Object(c.a)(this,e),this.loadPoints=function(e){return delete t.infoPoints,t.infoPoints={},new Promise((function(n,o){fetch(v.infopoints_folder+"/"+e+".json").catch((function(e){return o(e)})).then((function(e){return e.json()})).then((function(e){t.infoPoints=e,n(t.infoPoints)}))}))},this.savePoints=function(e){if(t.infoPoints){if(window.navigator&&window.navigator.msSaveOrOpenBlob){var n=new Blob([decodeURIComponent(encodeURI(JSON.stringify(t.infoPoints)))],{type:"application/json;charset=utf-8;"});navigator.msSaveOrOpenBlob(n,e)}else{var o=document.createElement("a");o.download=e,o.href="data:application/json;charset=utf-8;,"+encodeURIComponent(JSON.stringify(t.infoPoints)),o.target="_blank",document.body.appendChild(o),o.click(),document.body.removeChild(o)}}},this.addInfoPoint=function(e,n){var o={descrizione:e.descrizione,colore:e.colore||"#ffffff",point:n};return t.infoPoints[e.titolo]=o,o}}return Object(s.a)(e,null,[{key:"getInstance",value:function(){return null==e.myInstance&&(e.myInstance=new e),this.myInstance}}]),e}();g.myInstance=null;var y,b,C,E,x,k=g,P=n(513),S=n(512),O=n(515),j=n(58),M=n(228),I=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(c.a)(this,n);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).state={displayColorPicker:!1,background:"#fff"},e.handleClick=function(){e.setState({displayColorPicker:!e.state.displayColorPicker})},e.handleClose=function(){e.setState({displayColorPicker:!1})},e.handleChange=function(t){e.setState({background:t.hex})},e.handleChangeComplete=function(t){e.props.changeColor(t.hex),e.setState({background:t.hex})},e}return Object(s.a)(n,[{key:"render",value:function(){return a.a.createElement("div",null,a.a.createElement(j.a,{style:{backgroundColor:this.state.background},onClick:this.handleClick},!this.state.displayColorPicker&&"Apri ",this.state.displayColorPicker&&"Chiudi ","ColorPicker"),this.state.displayColorPicker?a.a.createElement("div",{style:{position:"absolute",zIndex:"2"}},a.a.createElement("div",{style:{position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"},onClick:this.handleClose}),a.a.createElement(M.ChromePicker,{color:this.state.background,onChange:this.handleChange,onChangeComplete:this.handleChangeComplete})):null)}}]),n}(a.a.Component),F={labelCol:{span:8},wrapperCol:{span:16}},z={wrapperCol:{offset:8,span:16}},R=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(c.a)(this,n);for(var o=arguments.length,i=new Array(o),r=0;r<o;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).formRef=a.a.createRef(),e.changeColor=function(t){e.formRef.current.setFieldsValue({colore:t})},e.onFinish=function(t){e.props.handleOk(t)},e.onFinishFailed=function(e){console.log("Failed:",e)},e}return Object(s.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{onMouseMove:function(e){return e.stopPropagation()}},a.a.createElement(P.a,{title:"Basic Modal",visible:this.props.visible,footer:null,onCancel:this.props.handleCancel},this.props.visible&&a.a.createElement(a.a.Fragment,null,a.a.createElement("p",null,"x: ",this.props.point.x.toString().substring(0,5)),a.a.createElement(S.a,Object.assign({},F,{name:"basic",initialValues:{remember:!0},ref:this.formRef,onFinish:this.onFinish,onFinishFailed:this.onFinishFailed}),a.a.createElement(S.a.Item,{label:"Titolo*",name:"titolo",rules:[{required:!0,message:"Campo obbligatorio!"}]},a.a.createElement(O.a,null)),a.a.createElement(S.a.Item,{label:"Colore",name:"colore"},a.a.createElement(I,{changeColor:this.changeColor})),a.a.createElement(S.a.Item,{label:"Descrizione",name:"descrizione"},a.a.createElement(O.a.TextArea,null)),a.a.createElement(S.a.Item,z,a.a.createElement(j.a,{type:"primary",htmlType:"submit"},"Aggiungi"))))))}}]),n}(a.a.Component),W=n(514),U=n(508),B=n(509),D=n(510),A=n(511),H=n(516),T=n(517),L=W.a.Option,N=k.getInstance(),J=new p.s;J.params.Points.threshold=.01;var _,K=new p.x,V=new p.c,q=0,X=[],Y=new p.u(.04,32,32),G=new p.n({color:"#FF0000"}),Q=new p.m(Y,G);Q.scale.set(1,1,1);var Z=v.filenames,$=Z[0],ee=v.pcd_folder+"/",te=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var o;return Object(c.a)(this,n),(o=t.call(this,e)).init=function(){w()(".alert-success").hide();var e=.75*window.innerWidth,t=.85*window.innerHeight;(C=new p.t).background=new p.d(32768),(E=new p.z({antialias:!0})).setPixelRatio(window.devicePixelRatio),E.setSize(e,t),E.dofAutofocus=!0,o.mount.appendChild(E.domElement),(y=new p.o(65,e/t,1,1e3)).position.set(8,4,8),y.up.set(0,1,0),o.setState({intrinsic:o.cameraMatrix2npString(y.projectionMatrix),extrinsic:o.cameraMatrix2npString(y.matrixWorldInverse)}),(b=new m.a(y,E.domElement)).enableDamping=!1,b.dampingFactor=.05,b.screenSpacePanning=!1,b.minDistance=1,b.maxDistance=500,b.maxPolarAngle=2*Math.PI,o.addPointcloud(),o.addSphereInfo();var n=new p.a(5);C.add(n),C.add(Q),window.addEventListener("resize",o.onWindowResize,!1),window.addEventListener("mousemove",o.onMouseMove,!1),window.addEventListener("click",o.onMouseClick,!1)},o.cameraMatrix2npString=function(e){for(var t="np.array([",n=0;n<4;n++){t+="[";for(var o=0;o<4;o++){var a=4*n+o;t+=0===e.elements[a]?e.elements[a]:e.elements[a].toFixed(4),3!==o&&(t+=", ")}t+="]",3!==n&&(t+=", ")}return t+="])"},o.addPointcloud=function(){x=new p.p(new p.h,new p.l),(new h.a).load(ee+"/"+$+".pcd",(function(e){x=e,C.add(x),_=[x];var t=x.geometry.boundingSphere.radius;y.position.set(1.5*t,.5*t,1.5*t)}),(function(e){o.setState({loaded:Math.round(e.loaded/e.total*100)})}))},o.removePointcloud=function(){C.remove(x)},o.removeSphereKps=function(){X.forEach((function(e){var t=C.getObjectByProperty("uuid",e.uuid);t.geometry.dispose(),t.material.dispose(),C.remove(t)})),E.renderLists.dispose(),X=[]},o.addSphereInfo=function(){N.loadPoints($).catch((function(e){console.log(e)})).then((function(e){console.log(e),Object.keys(e).forEach((function(t){var n=y.position.distanceTo(e[t].point);console.log(n);var o=new p.u(n/32,32,32),a=new p.n({color:e[t].colore}),i=new p.m(o,a);i.position.copy(e[t].point),X.push({uuid:i.uuid,titolo:t}),C.add(i)}))}))},o.animate=function(){o.setState({intrinsic:o.cameraMatrix2npString(y.projectionMatrix),extrinsic:o.cameraMatrix2npString(y.matrixWorldInverse)}),requestAnimationFrame(o.animate),b.update(),o.renderScene()},o.renderScene=function(){if(y.updateMatrixWorld(),J.setFromCamera(K,y),"undefined"!==typeof _){var e=J.intersectObjects(_),t=e.length>0?e[0]:null;q>.02&&null!=t&&(o.setState({point:t.point}),Q.position.copy(t.point),q=0)}q+=V.getDelta(),E.render(C,y)},o.onMouseMove=function(e){e.preventDefault(),K.x=e.clientX/o.mount.clientWidth*2-1,K.y=-(e.clientY-.1*window.innerHeight)/o.mount.clientHeight*2+1},o.onMouseClick=function(e){e.shiftKey&&o.state.point.x&&o.showModal(o.state.point)},o.onWindowResize=function(){y.aspect=.75*window.innerWidth/(.85*window.innerHeight),y.updateProjectionMatrix(),E.setSize(.75*window.innerWidth,.85*window.innerHeight)},o.scaleDown=function(){var e=C.getObjectByName($+".pcd");e.material.size*=.8,e.material.needsUpdate=!0},o.scaleUp=function(){var e=C.getObjectByName($+".pcd");e.material.size*=1.2,e.material.needsUpdate=!0},o.onFrameUpdate=function(e){e!=$&&($=e,o.removeSphereKps(),o.removePointcloud(),o.addPointcloud(),o.addSphereInfo())},o.showModal=function(e){o.setState({showModal:!0,selectedPoint:e})},o.handleOk=function(e){console.log(e);var t,n,a=N.addInfoPoint(e,o.state.selectedPoint),i=!1,r=Object(l.a)(X);try{for(r.s();!(n=r.n()).done;){var c=n.value;if(console.log(c),c.titolo===e.titolo){(t=C.getObjectByProperty("uuid",c.uuid)).position.copy(o.state.point),i=!0;break}}}catch(u){r.e(u)}finally{r.f()}if(!i){var s=new p.u(.04,32,32),d=new p.n({color:a.colore});(t=new p.m(s,d)).position.copy(a.point),X.push({uuid:t.uuid,titolo:e.titolo}),C.add(t)}o.setState({showModal:!1})},o.handleCancel=function(e){o.setState({showModal:!1})},o.state={showModal:!1,loaded:0,intrinsic:0,extrinsic:0,point:[],selectedPoint:[]},o}return Object(s.a)(n,[{key:"componentDidMount",value:function(){this.init(),this.animate()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize"),window.removeEventListener("mousemove"),window.removeEventListener("click")}},{key:"render",value:function(){var e=this;return a.a.createElement("div",null,a.a.createElement(R,{handleCancel:this.handleCancel,handleOk:this.handleOk,visible:this.state.showModal,point:this.state.selectedPoint}),a.a.createElement(U.a,{style:{height:"100vh",width:"100vw",backgroundColor:"#404040"}},a.a.createElement(B.a,{style:{width:.75*window.innerWidth}},a.a.createElement(U.a,{style:{height:.1*window.innerHeight}},a.a.createElement(j.a,{onClick:function(){return N.savePoints($)}},"Salva InfoPoint"),a.a.createElement(j.a,{onClick:this.scaleUp},a.a.createElement(H.a,null)),a.a.createElement(j.a,{onClick:this.scaleDown},a.a.createElement(T.a,null))),a.a.createElement(U.a,{style:{height:.85*window.innerHeight}},a.a.createElement("div",{ref:function(t){e.mount=t}})),a.a.createElement(U.a,{style:{height:.05*window.innerHeight}},a.a.createElement(D.a,{direction:"horizontal"},a.a.createElement(A.a.Text,{style:{color:"red"}},"x: ",this.state.point.x?this.state.point.x.toFixed(4):0),a.a.createElement(A.a.Text,{style:{color:"lime"}},"y: ",this.state.point.y?this.state.point.y.toFixed(4):0),a.a.createElement(A.a.Text,{style:{color:"blue"}},"z: ",this.state.point.z?this.state.point.z.toFixed(4):0)))),a.a.createElement(B.a,{flex:5},a.a.createElement(U.a,null,a.a.createElement(D.a,{direction:"horizontal"},a.a.createElement(A.a.Text,{style:{color:"white",fontSize:"2em"}},"Nuvola:"),a.a.createElement(W.a,{defaultValue:$,style:{width:120},onChange:this.onFrameUpdate},Z.map((function(e,t){return a.a.createElement(L,{key:t,value:e},e)}))))),a.a.createElement(U.a,null,"lista infopoints"))))}}]),n}(o.Component);r.a.render(a.a.createElement(te,null),document.getElementById("root"))},88:function(e){e.exports=JSON.parse('{"build":false,"filenames":["base","casa",2,3,4,5],"pcd_folder":"./data/pointclouds","infopoints_folder":"./data/infopoints"}')}},[[249,1,2]]]);
//# sourceMappingURL=main.c983e1fc.chunk.js.map